<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detector de Movimiento de los Ojos</title>
  <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>

 <script>
  let isCalibrated = false;
  let counter = 0;
  let record = 0;
  let timer = null;

  const startBtn = document.getElementById("startBtn");
  const stopBtn = document.getElementById("stopBtn");
  const statusText = document.getElementById("statusText");
  const counterText = document.getElementById("counterText");
  const recordText = document.getElementById("recordText");
  const exitBtn = document.getElementById("exitBtn");

  // Inicia la calibración de la mirada
  startBtn.addEventListener("click", function () {
    webgazer
      .setGazeListener(function (data, elapsedTime) {
        if (data == null) {
          return;
        }
        // Muestra el porcentaje de completado de la calibración
        statusText.innerText = `Calibración ${parseInt(
          webgazer.getPercentCalibrated()
        )}% completada`;
      })
      .begin();

    // Muestra el punto rojo y comienza el contador cuando la calibración esté completada
    setTimeout(() => {
      if (webgazer.isReady()) {
        isCalibrated = true;
        statusText.innerText = "Calibración completada";

        // Muestra el punto rojo y actualiza el contador
        const pointDiv = document.createElement("div");
        pointDiv.id = "pointDiv";
        document.body.appendChild(pointDiv);

        setInterval(() => {
          if (isCalibrated) {
            const prediction = webgazer.getCurrentPrediction();
            if (prediction) {
              const x = prediction.x;
              const y = prediction.y;
              const maxX = window.innerWidth;
              const maxY = window.innerHeight;
              pointDiv.style.top = `${y * maxY}px`;
              pointDiv.style.left = `${x * maxX}px`;

              if (x > 0.45 && x < 0.55 && y > 0.45 && y < 0.55) {
                if (timer === null) {
                  timer = setInterval(() => {
                    counter++;
                    counterText.innerText = `Tiempo: ${counter}s`;
                    if (counter > record) {
                      record = counter;
                      recordText.innerText = `Record: ${record}s`;
                    }
                  }, 1000);
                }
              } else {
                clearInterval(timer);
                timer = null;
                counter = 0;
                counterText.innerText = "";
              }
            }
          }
        }, 100);
      }
    }, 5000); // Espera 5 segundos antes de mostrar el punto rojo y comenzar el contador
  });

  // Detiene la detección del movimiento de los ojos
  stopBtn.addEventListener("click", function () {
    isCalibrated = false;
    clearInterval(timer);
    timer = null;
    counter = 0;
    counterText.innerText = "";
    recordText.innerText = "";
    document.getElementById("pointDiv").remove();
    statusText.innerText = "";
    webgazer.pause();
  });

  // Redirige al link especificado al hacer clic en el botón "Salir de la sesión"
  exitBtn.addEventListener("click", function () {
    window.location.href = "TU LINK AQUÍ";
  });
</script>

  
<style>
    
     .container {
        max-width: 800px;
        margin: 0 auto;
        font-size: 16px;
      }

      #startBtn, #stopBtn {
        padding: 10px;
        background-color: #007bff;
        color: #fff;
        border-radius: 5px;
        border: none;
        cursor: pointer;
      }

      #startBtn:hover, #stopBtn:hover {
        background-color: #0069d9;
      }

      #statusText {
        margin-top: 20px;
        font-size: 18px;
      }

      #counterText {
        margin-top: 20px;
        font-size: 24px;
        color: red;
      }

      #recordText {
        margin-top: 20px;
        font-size: 18px;
      }

      #exitBtn {
        margin-top: 40px;
        padding: 10px;
        background-color: #dc3545;
        color: #fff;
        border-radius: 5px;
        border: none;
        cursor: pointer;
      }

      #exitBtn:hover {
        background-color: #c82333;
      }
    
  </style>
</head>


<body>
  <div class="container">
    <h1>Detector de Movimiento de los Ojos</h1>
    <p>Semilleros de Investigación - Corporación Universitaria UNITEC</p>
    <p>Esta aplicación usa la libreria WebGazer.js como modelo de Inteligencia Artificial.</p>
    <p>Haga clic en el botón a continuación para iniciar la calibración:</p>
      <button id="startBtn">Iniciar Calibración</button>
      <p id="statusText"></p>
      <p id="counterText"></p>
      <p id="recordText"></p>
      <button id="stopBtn" style="display:none;">Detener</button>
      <button id="exitBtn">Salir de la sesión</button>

    <button id="exitBtn">Salir de la sesión</button>
</body>

</html>
